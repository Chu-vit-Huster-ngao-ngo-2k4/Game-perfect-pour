:root {
    --bg-dark: #0a0e27; --bg-light: #1a237e;
    --water-color: #4fc3f7; --faucet-color: #e0e0e0; --valve-color: #ff1744;
}
body { margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; background-color: #050714; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; user-select: none; -webkit-user-select: none; }
#game-container { position: relative; width: 360px; height: 640px; background: linear-gradient(to bottom, var(--bg-dark), var(--bg-light)); border-radius: 24px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.8); }

/* HUD */
#hud-top { position: absolute; top: 0; width: 100%; height: 140px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; background: rgba(0, 0, 0, 0.4); z-index: 30; border-bottom: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }

#hud-row-1 { display: flex; align-items: center; gap: 15px; }
#level-indicator { background: white; color: #1a237e; padding: 4px 20px; border-radius: 20px; font-weight: bold; font-size: 14px; }
#coin-display { background: rgba(255, 215, 0, 0.2); color: #ffd700; padding: 4px 15px; border-radius: 20px; font-weight: bold; border: 1px solid #ffd700; font-size: 14px; display: flex; align-items: center; gap: 5px; }

#meter-container { width: 240px; height: 10px; background: rgba(255,255,255,0.2); border-radius: 6px; border: 2px solid #fff; overflow: hidden; }
#meter-fill { width: 0%; height: 100%; background: linear-gradient(to right, #4caf50, #ffeb3b, #ff5252); }
.info-badge { background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); font-size: 12px; color: white; font-weight: bold; }

/* BỘ CHỌN LEVEL & BOOSTER */
#level-picker { position: fixed; right: 18px; top: 18px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 10px; border-radius: 12px; z-index: 250; color: white; backdrop-filter: blur(6px); }
#level-picker select { background: rgba(0,0,0,0.5); color: #fff; border: 1px solid #555; padding: 5px; border-radius: 5px; margin-right: 5px; outline: none; }
#level-picker button { background: #ffeb3b; color: #111; border: none; padding: 6px 10px; border-radius: 5px; font-weight: bold; cursor: pointer; }

#booster-panel { position: absolute; left: 10px; top: 160px; display: flex; flex-direction: column; gap: 10px; z-index: 250; }
.booster-btn { width: 50px; height: 50px; background: rgba(255,255,255,0.15); border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 22px; backdrop-filter: blur(5px); transition: all 0.3s; }
.booster-btn.active { background: #ffeb3b; border-color: #fff; box-shadow: 0 0 15px #ffeb3b; transform: scale(1.1); }

#booster-modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 300; display: none; align-items: center; justify-content: center; }
.b-modal-content { background: white; padding: 20px; border-radius: 20px; text-align: center; width: 220px; }
.b-option { padding: 12px; margin: 8px 0; border-radius: 10px; border: 2px solid #eee; font-weight: bold; cursor: pointer; transition: background 0.2s; color: #333; }
.b-option:hover { background: #f0f0f0; }

/* VÒI NƯỚC */
#faucet-system { position: absolute; top: 155px; left: 50%; transform: translateX(-50%); width: 100px; z-index: 20; display: flex; flex-direction: column; align-items: center; }
#valve { width: 75px; height: 75px; background: var(--valve-color); border-radius: 50%; cursor: grab; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 0 #b71c1c; z-index: 21; margin-bottom: -15px; }
#valve::after { content: ''; width: 48px; height: 10px; background: #fff; border-radius: 5px; }
#spout { width: 38px; height: 55px; background: var(--faucet-color); border-radius: 5px 5px 0 0; }
#nozzle { width: 46px; height: 15px; background: #111; border-radius: 3px; margin-top: -2px; }

/* NƯỚC */
#stream { position: absolute; top: 280px; left: 50%; transform: translateX(-50%); width: 0; height: 0; background: linear-gradient(90deg, transparent 15%, rgba(255,255,255,0.4) 25%, transparent 35%, rgba(255,255,255,0.2) 75%, transparent 85%), repeating-linear-gradient(180deg, rgba(255,255,255,0.4) 0px, transparent 2px, transparent 15px), var(--water-color); background-size: 100% 100%, 100% 30px, 100% 100%; animation: flowAnim 0.2s linear infinite; opacity: 0.9; pointer-events: none; z-index: 5; box-shadow: 0 0 10px var(--water-color); }
@keyframes flowAnim { to { background-position: 0 0, 0 30px, 0 0; } }

.water-fill { position: absolute; left: 0; bottom: 0; width: 100%; height: 0%; background: linear-gradient(180deg, #4fc3f7, #1565c0); z-index: 8; overflow: visible; transition: height 180ms linear; }
.wave { position: absolute; left: -50%; top: -8px; width: 200%; height: 20px; background-repeat: repeat-x; }
.wave1 { background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 60'><path d='M0 30 C150 0 350 60 600 30 C850 0 1050 60 1200 30 L1200 60 L0 60 Z' fill='%234fc3f7'/></svg>"); animation: waveAnim 4s linear infinite; opacity: 0.8; }
.wave2 { background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 60'><path d='M0 30 C150 60 350 0 600 30 C850 60 1050 0 1200 30 L1200 60 L0 60 Z' fill='%230288d1'/></svg>"); animation: waveAnim 6s linear reverse infinite; opacity: 0.5; top: -5px; }
@keyframes waveAnim { from { transform: translateX(0); } to { transform: translateX(-50%); } }

/* Disable wave visuals when `.no-waves` is applied (used for paint-like levels) */
.water-fill.no-waves .wave,
#trough .trough-fill.no-waves .wave {
    display: none;
}

.bubble { position: absolute; bottom: 10px; background: rgba(255,255,255,0.6); border-radius: 50%; pointer-events: none; animation: bubbleRise 1.5s ease-out forwards; z-index: 9; }
@keyframes bubbleRise { 0% { transform: translateY(0) scale(1); opacity: 0.8; } 100% { transform: translateY(-120px) scale(0.4); opacity: 0; } }
.drop { position: absolute; width: 10px; height: 12px; background: var(--water-color); border-radius: 50%; left: 50%; transform: translateX(-50%); top: 280px; animation: fall 0.45s ease-in forwards; z-index: 5; }
@keyframes splash { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0.3); opacity: 0; } }
.splash-drop { position: absolute; width: 8px; height: 8px; background: var(--water-color); border-radius: 50%; pointer-events: none; z-index: 9; animation: splash 0.6s ease-out forwards; }
.paint-splash { position: absolute; width: 14px; height: 14px; background: #ff66cc; border-radius: 50%; pointer-events: none; z-index: 12; animation: splash 1.1s ease-out forwards; box-shadow: 0 0 12px rgba(255,102,204,0.7); }
.paint-drop { position: absolute; width: 14px; height: 16px; background: #ff66cc; border-radius: 50%; left: 50%; transform: translateX(-50%); top: 280px; animation: fall 1.2s ease-in forwards; z-index: 6; box-shadow: 0 0 18px rgba(255,102,204,0.8); }
@keyframes fall { to { transform: translate(-50%, 260px); opacity: 0; } }

/* MÁNG (level 11) */
#trough { position: absolute; left: 50%; transform: translateX(-50%); top: 356px; width: 80px; height: 36px; pointer-events: none; z-index: 15; display: none; }
#trough .trough-shape { position: relative; width: 80px; height: 36px; background: rgba(100, 120, 150, 0.6); clip-path: polygon(0 0, 100% 0, 50% 100%); overflow: visible; border: 2px solid rgba(255,255,255,0.8); }
#trough .trough-mask { position: absolute; left: 0; bottom: 0; top: auto; width: 100%; height: 0%; overflow: hidden; transition: height 180ms linear; }
#trough .trough-fill { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: var(--water-color); clip-path: polygon(0 0, 100% 0, 50% 100%); opacity: 0.95; }
#trough .trough-fill .wave { position: absolute; left: -20%; top: -6px; width: 140%; height: 18px; background-repeat: repeat-x; opacity: 0.9; }
#trough .trough-fill .wave1 { background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 60'><path d='M0 30 C150 0 350 60 600 30 C850 0 1050 60 1200 30 L1200 60 L0 60 Z' fill='%234fc3f7'/></svg>"); animation: waveAnim 3.5s linear infinite; }
#trough .trough-fill .wave2 { background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 60'><path d='M0 30 C150 60 350 0 600 30 C850 60 1050 0 1200 30 L1200 60 L0 60 Z' fill='%230288d1'/></svg>"); animation: waveAnim 5s linear reverse infinite; opacity: 0.6; top: -4px; }
#trough .overflow-indicator { position: absolute; left: 0; bottom: -6px; width: 100%; height: 8px; pointer-events: none; }
/* overflow streams from two sides */
.overflow-stream { position: absolute; width: 8px; height: 0px; background: linear-gradient(90deg, transparent 15%, rgba(255,255,255,0.4) 25%, transparent 35%, rgba(255,255,255,0.2) 75%, transparent 85%), repeating-linear-gradient(180deg, rgba(255,255,255,0.4) 0px, transparent 2px, transparent 15px), var(--water-color); background-size: 100% 100%, 100% 30px, 100% 100%; border-radius: 3px; left: 0; top: 8px; pointer-events: none; z-index: 14; opacity: 0.9; }
@keyframes overflowAnimFall { to { background-position: 0 0, 0 30px, 0 0; } }
.overflow-stream.animate { animation: overflowAnimFall 0.2s linear infinite; }
#trough .trough-indicator { position: absolute; left: 0; top: -18px; width: 100%; text-align: center; color: #fff; font-size: 12px; font-weight: bold; text-shadow: 0 1px 3px rgba(0,0,0,0.6); display: none; }
.trough-drop { position: absolute; width: 10px; height: 12px; background: var(--water-color); border-radius: 50%; left: 50%; transform: translateX(-50%); top: 380px; z-index: 14; animation: fall 0.45s ease-in forwards; }
/* LỌ */
#glass-wrapper { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 220px; height: 260px; display: flex; align-items: flex-end; justify-content: center; }
#glass { position: relative; width: 130px; height: 250px; background: rgba(255,255,255,0.1); border: 4px solid rgba(255,255,255,0.6); border-top: none; overflow: hidden; z-index: 10; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.shape-standard { border-radius: 0 0 35px 35px; width: 130px !important; }
.shape-neck { clip-path: polygon(35% 0%, 65% 0%, 65% 25%, 100% 100%, 0% 100%, 35% 25%); border-radius: 0; width: 160px !important; }
.shape-erlenmeyer { clip-path: polygon(45% 0%, 55% 0%, 55% 20%, 100% 100%, 0% 100%, 45% 20%); border-radius: 0; width: 180px !important; }
.shape-martini { clip-path: polygon(12% 0%, 88% 0%, 70% 36%, 82% 62%, 50% 100%, 18% 62%, 30% 36%); border-radius: 6px; width: 160px !important; }
.shape-chalice { clip-path: polygon(10% 0%, 90% 0%, 78% 30%, 64% 50%, 64% 78%, 56% 88%, 70% 100%, 30% 100%, 44% 88%, 36% 78%, 36% 50%, 22% 30%); border-radius: 8px; width: 170px !important; }
.shape-wide { border-radius: 0 0 45px 45px; width: 220px !important; }
.shape-bulb { clip-path: ellipse(50% 60% at 50% 40%); border-radius: 0; width: 160px !important; }

#target-zone { position: absolute; width: 100%; height: 4%; background: rgba(255, 235, 59, 0.3); bottom: 70%; border-top: 2px solid #ffeb3b; border-bottom: 2px solid #ffeb3b; z-index: 20; transition: all 0.3s ease; }

/* TUTORIAL */
#tutorial-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 100; display: none; flex-direction: column; align-items: center; pointer-events: none; }
.tutorial-text { color: white; font-weight: bold; font-size: 18px; text-align: center; margin-top: 320px; text-shadow: 0 2px 10px black; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 15px; width: 80%; }
.hand-icon { width: 50px; position: absolute; top: 180px; left: 50%; transform: translateX(-50%); }
.anim-right { animation: handRight 1.5s infinite ease-in-out; }
.anim-left { animation: handLeft 1.5s infinite ease-in-out; }
@keyframes handRight { 0% { transform: translateX(-40px); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(40px); opacity: 0; } }
@keyframes handLeft { 0% { transform: translateX(40px); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(-40px); opacity: 0; } }

/* POPUP */
#popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: none; align-items: center; justify-content: center; z-index: 400; backdrop-filter: blur(8px); }
.modal { background: #fff; padding: 40px 30px; border-radius: 30px; text-align: center; width: 270px; }
.btn { padding: 15px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; width: 100%; margin: 10px 0; font-size: 17px; }
